{% extends "admin/base_site.html" %}
{% load static %}

{% block extrahead %}
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600&display=swap" rel="stylesheet">
<style>
    body { font-family: 'Nunito', sans-serif; background: #f8f9fa; }
    .dashboard-cards { display: flex; flex-wrap: wrap; gap: 20px; margin: 20px 0; }
    .card { flex: 1; min-width: 180px; background: white; padding: 20px; border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1); transition: transform 0.2s; cursor: default; }
    .card:hover { transform: translateY(-5px); }
    .card h3 { margin: 0 0 10px; font-weight: 600; color: #1e293b; }
    .card p { font-size: 1.5rem; color: #0ea5e9; font-weight: bold; }
    .status-badge { padding: 5px 10px; border-radius: 20px; color: white; font-weight: 600; }
    .status-new { background-color: #facc15; } /* yellow */
    .status-confirmed { background-color: #22c55e; } /* green */
    .status-viewed {background-color: #6b7280;}
    .reservation-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    .reservation-table th, .reservation-table td { padding: 12px; border-bottom: 1px solid #e5e7eb; text-align: left; }
    .reservation-table th { background: #e0f2fe; color: #0f172a; }
    .reservation-table tbody tr:hover { background: #e0f7ff; cursor: pointer; }
</style>
{% endblock %}

{% block content %}
<h1>Welcome, Dr. {{ user.first_name }} üë©‚Äç‚öïÔ∏è</h1>

<div class="dashboard-cards">
    <div class="card">
        <h3>New Reservations</h3>
        <p>{{ new_reservations }}</p>
    </div>
    <div class="card">
        <h3>Confirmed Reservations</h3>
        <p>{{ confirmed_reservations }}</p>
    </div>
    <div class="card">
        <h3>Total Reservations</h3>
        <p>{{ total_reservations }}</p>
    </div>
</div>

<h2>Latest Reservations</h2>
<table class="reservation-table">
    <thead>
        <tr>
            <th>Name</th>
            <th>Email</th>
            <th>Phone</th>
            <th>Day</th>
            <th>Time</th>
            <th>Status</th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        {% for res in reservations %}
        <tr onclick="window.location='{% url 'admin:reservation-view' res.id %}'">
            <td>{{ res.names }}</td>
            <td>{{ res.emails }}</td>
            <td>{{ res.phones }}</td>
            <td>{{ res.days }}</td>
            <td>{{ res.times }}</td>
            <td>
                {% if not res.viewed %}
                    <span class="status-badge status-new">New</span>
                {% elif res.status %}
                    <span class="status-badge status-confirmed">Confirmed</span>
                {% else %}
                    <span class="status-badge status-viewed" >Viewed</span>
                {% endif %}
            </td>
            <td style="text-align: right;padding-right: 5px;"> 
                <form method="post" action="{% url 'admin:reservation-delete' res.id %}" style="display:inline;">
                {% csrf_token %}
                    <button type="submit" onclick="event.stopPropagation();"
                            style="background:#ef4444; color:white; border:none; padding:5px 10px; border-radius:5px; cursor:pointer;width:60px;margin-left:-200px;">
                    Delete
                    </button>
                </form>
            </td>
        </tr>
        {% empty %}
        <tr><td colspan="6">No reservations yet.</td></tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}
